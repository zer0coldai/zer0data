services:
  sync:
    build:
      context: ../..
      dockerfile: docker/sync/Dockerfile
    container_name: zer0data-sync
    volumes:
      - ../../data/download:/data
      - ../../data/logs:/logs
      - ~/.ssh:/tmp/.ssh-mount:ro
    env_file:
      - ../../.env
    environment:
      LOCAL_DATA_DIR: /data
      LOCAL_STATE_DIR: /data/_ingested
      LOCAL_LOG_DIR: /logs
      CLICKHOUSE_HOST: host.docker.internal
      CLICKHOUSE_PORT: 8123
      CLICKHOUSE_DB: zer0data
      # rclone R2 config via env vars (credentials from .env file)
      RCLONE_CONFIG_R2_TYPE: s3
      RCLONE_CONFIG_R2_PROVIDER: Cloudflare
      RCLONE_CONFIG_R2_ACCESS_KEY_ID: ${R2_ACCESS_KEY_ID}
      RCLONE_CONFIG_R2_SECRET_ACCESS_KEY: ${R2_SECRET_ACCESS_KEY}
      RCLONE_CONFIG_R2_ENDPOINT: ${R2_ENDPOINT}
      RCLONE_CONFIG_R2_NO_CHECK_BUCKET: "true"
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "5"
